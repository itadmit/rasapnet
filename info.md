×œ×”×œ×Ÿ ××¤×™×•×Ÿ ××¡×•×“×¨ ×œ××¢×¨×›×ª â€œ×ª×•×¨× ×•×™×•×ª + × ×™×§×•×“ ×”×•×’× ×•×ªâ€ ×¢×‘×•×¨ ×¨×¡×´×¤ ××—×œ×§×”/×™×—×™×“×”, ×›×•×œ×œ ×—×™×‘×•×¨ ×œ×ª×–×›×•×¨×•×ª ×‘-True Story WhatsApp API.

---

## 1) ××˜×¨×ª ×”××¢×¨×›×ª

×œ××¤×©×¨ ×œ×¨×¡×´×¤:

* ×œ×”×’×“×™×¨ ×¡×•×’×™ ×ª×•×¨× ×•×™×•×ª (××˜×‘×— / ×©×™×¨×•×ª×™× / × ×™×§×™×•×Ÿ ×™×—×™×“×” / ×©××™×¨×•×ª / ×›×œ ×“×‘×¨ ××—×¨)
* ×œ× ×”×œ ×—×™×™×œ×™× ×œ×¤×™ ××—×œ×§×•×ª/×¦×•×•×ª×™×
* ×œ×©×‘×¥ ×ª×•×¨× ×•×™×•×ª ×™×“× ×™×ª ××• ××•×˜×•××˜×™×ª
* ×œ××“×•×“ â€œ×”×•×’× ×•×ªâ€ ×‘×¢×–×¨×ª × ×™×§×•×“/××©×§×œ ×œ×›×œ ×ª×•×¨× ×•×ª
* ×œ×©×œ×•×— ×ª×–×›×•×¨×•×ª ×‘×•×•××˜×¡××¤: ×©×‘×•×¢×™×ª + ×™×•× ×œ×¤× ×™

---

## 2) ×™×©×•×™×•×ª ××¨×›×–×™×•×ª (××” ×× ×”×œ×™× ×‘××¢×¨×›×ª)

### ×. ××‘× ×” ××¨×’×•× ×™

* **×™×—×™×“×”** (××•×¤×¦×™×•× ×œ×™ ×× ×”×›×œ ×ª×—×ª ×™×—×™×“×” ××—×ª)
* **××—×œ×§×•×ª** (×/×‘/×’â€¦)
* **×¦×•×•×ª×™× ×‘×ª×•×š ××—×œ×§×”** (××•×¤×¦×™×•× ×œ×™)

### ×‘. ×—×™×™×œ×™×

×œ×›×œ ×—×™×™×œ × ×©××•×¨:

* ×©× ××œ×
* ×˜×œ×¤×•×Ÿ (×œ×•×•××˜×¡××¤)
* ××—×œ×§×”/×¦×•×•×ª
* ×¡×˜×˜×•×¡: ×¤×¢×™×œ / ×‘×”×›×©×¨×” / ×¤×˜×•×¨ ×–×× ×™ / ×‘×—×•×¤×©×”
* â€œ×›×œ×œ×™×â€ ××™×©×™×™×: ×œ× ×œ×©×‘×¥ ×‘×™××™× ××¡×•×™××™×, ××’×‘×œ×•×ª ×¨×¤×•××™×•×ª, ×ª×¤×§×™×“×™× ××™×•×—×“×™× ×•×›×•×³

### ×’. ×¡×•×’×™ ×ª×•×¨× ×•×™×•×ª (Actions / Duties)

×œ×›×œ ×¡×•×’ ×ª×•×¨× ×•×ª:

* ×©× (×œ××©×œ â€œ××˜×‘×— ×¢×¨×‘â€)
* ×§×˜×’×•×¨×™×” (××˜×‘×—/×©×™×¨×•×ª×™×/× ×™×§×™×•×Ÿ/××—×¨)
* ×ª×“×™×¨×•×ª ×‘×¨×™×¨×ª ××—×“×œ (×™×•××™/×©×‘×•×¢×™/×—×•×“×©×™)
* ××©×š (××•×¤×¦×™×•× ×œ×™)
* **× ×™×§×•×“/××©×§×œ ×”×•×’× ×•×ª** (×œ××©×œ ××˜×‘×—=3, ×©×™×¨×•×ª×™×=2, × ×™×§×™×•×Ÿ ×™×—×™×“×”=4)
* ×”×× × ×™×ª×Ÿ ×œ×©×‘×¥ ×™×•×ª×¨ ××—×™×™×œ ××—×“ ×œ××•×ª×• ××™×¨×•×¢ (×›××•×ª × ×“×¨×©×ª)

### ×“. ××™×¨×•×¢×™ ×ª×•×¨× ×•×ª (Instances)

×–×” ×”â€×©×™×‘×•×¥ ×‘×¤×•×¢×œâ€:

* ×¡×•×’ ×ª×•×¨× ×•×ª
* ×ª××¨×™×š + ×©×¢×”/×˜×•×•×—
* ××™ ×©×•×‘×¥ (××—×“ ××• ×™×•×ª×¨)
* ×¡×˜×˜×•×¡: ××ª×•×›× ×Ÿ / ×‘×•×¦×¢ / ×”×•×—×œ×£ / ×‘×•×˜×œ / ×œ× ×‘×•×¦×¢
* ×”×¢×¨×•×ª ×¨×¡×´×¤

### ×”. × ×™×§×•×“ ×”×•×’× ×•×ª

×œ×›×œ ×—×™×™×œ × ×¦×‘×•×¨ â€œ× ×§×•×“×•×ª ×¢×•××¡â€ ×œ×¤×™ ×ª×•×¨× ×•×™×•×ª ×©×‘×™×¦×¢ ×‘×¤×•×¢×œ (××• ×œ×¤×™ ×¡×˜×˜×•×¡).
×”××˜×¨×”: ×›×©××©×‘×¦×™× ××•×˜×•××˜×™×ª â€“ ×œ×‘×—×•×¨ ××ª ××™ ×©×™×© ×œ×• ×”×›×™ ××¢×˜ × ×§×•×“×•×ª (×‘×›×¤×•×£ ×œ×›×œ×œ×™×).

---

## 3) ×—×•×§×™ ×”×•×’× ×•×ª (××™×š ××—×©×‘×™× ×•××—×œ×™×˜×™×)

### × ×™×§×•×“ ×‘×¡×™×¡×™

* ×œ×›×œ ×¡×•×’ ×ª×•×¨× ×•×ª ×™×© **weight** (××©×§×œ).
* ×›××©×¨ ××™×¨×•×¢ ××¡×•××Ÿ **â€œ×‘×•×¦×¢â€** â†’ ××•×¡×™×¤×™× ×œ×—×™×™×œ ××ª ×”××©×§×œ.

### ×”×ª×××•×ª (××•×¤×¦×™×•× ×œ×™ ××‘×œ ××•××œ×¥)

* â€œ××§×“× ×©×‘×ª/×—×’â€ (×œ××©×œ Ã—1.5)
* â€œ×ª×•×¨× ×•×ª ×›×¤×•×œ×”â€ (×× ××™×¨×•×¢ ×“×•×¨×© 2 ×× ×©×™× â€“ ×›×œ ××—×“ ××§×‘×œ ××ª ××œ×•× ×”××©×§×œ ××• ×—×¦×™, ×œ×¤×™ ×”×—×œ×˜×”)
* â€œ×¤×˜×•×¨â€ â†’ ×œ× ××©×‘×¦×™× ×‘×›×œ×œ / ××• ××©×‘×¦×™× ××‘×œ ×‘×œ×™ × ×§×•×“×•×ª (×‘×“×´×› ×œ× ××©×‘×¦×™×)

### ××œ×’×•×¨×™×ª× ×©×™×‘×•×¥ ××•×˜×•××˜×™ (×¤×©×•×˜ + ×¢×•×‘×“)

×‘×¢×ª ×™×¦×™×¨×ª ×©×™×‘×•×¥ ×œ×ª××¨×™×š:

1. ××¡× × ×™× ××•×¢××“×™× ×©×œ× ×–××™× ×™× (×—×•×¤×©×”/×¤×˜×•×¨/××’×‘×œ×•×ª ×™×•×)
2. ××—×©×‘×™× ×œ×›×œ ××•×¢××“ **score_total** ×‘×ª×§×•×¤×” × ×‘×—×¨×ª (×œ××©×œ 60 ×™×•× ××—×•×¨×”)
3. ×‘×•×—×¨×™× ××ª ××™ ×©×”-score_total ×©×œ×• ×”×›×™ × ××•×š
4. ×× ×™×© ×©×•×•×™×•×Ÿ â†’ ×©×•×‘×¨×™× ×œ×¤×™ â€œ××™ ×¢×‘×¨ ×”×›×™ ×”×¨×‘×” ×–××Ÿ ×××– ×ª×•×¨× ×•×ªâ€ / ××• ×¨× ×“×•××œ×™ ××‘×•×§×¨

> ×–×” × ×•×ª×Ÿ â€œ×”×•×’× ×•×ª ××ª×’×œ×’×œ×ªâ€ ×‘×œ×™ ×œ×”×¡×ª×‘×š.

---

## 4) ××¡×›×™×/×–×¨×™××•×ª ×¢×‘×•×“×” (UX)

### 4.1 ×“×©×‘×•×¨×“ ×¨×¡×´×¤

* ×ª×•×¨× ×•×™×•×ª ×”×™×•× / ××—×¨ / ×”×©×‘×•×¢
* â€œ××™ ×”×›×™ ×¢××•×¡ / ××™ ×”×›×™ ×¤× ×•×™â€ ×œ×¤×™ × ×§×•×“×•×ª
* ×›×¤×ª×•×¨: ×™×¦×™×¨×ª ×©×™×‘×•×¥ ×—×“×©
* ×›×¤×ª×•×¨: ×”×¨×¦×ª â€œ×©×™×‘×•×¥ ××•×˜×•××˜×™ ×œ×©×‘×•×¢ ×”×‘×â€
* ××¦×‘ ×ª×–×›×•×¨×•×ª: ××—×•×‘×¨ True Story? ×ª×§×™×Ÿ?

### 4.2 × ×™×”×•×œ ×—×™×™×œ×™×

* ×¨×©×™××ª ×—×™×™×œ×™× + ×¤×™×œ×˜×¨ ×œ×¤×™ ××—×œ×§×”/×¡×˜×˜×•×¡
* ×¢×¨×™×›×ª ×—×™×™×œ (×˜×œ×¤×•×Ÿ, ×›×œ×œ×™×, ×¡×˜×˜×•×¡)
* ×™×™×‘×•× ××¨×©×™××” (CSV) ××•×¤×¦×™×•× ×œ×™

### 4.3 × ×™×”×•×œ ×¡×•×’×™ ×ª×•×¨× ×•×™×•×ª

* ×”×•×¡×¤×”/×¢×¨×™×›×”: ×©×, ×§×˜×’×•×¨×™×”, ××©×§×œ, ×ª×“×™×¨×•×ª, ×›××•×ª × ×“×¨×©×ª
* ××¤×©×¨ ×œ×›×‘×•×ª ×¡×•×’ ×ª×•×¨× ×•×ª ×‘×œ×™ ×œ××—×•×§

### 4.4 ×œ×•×— ×©×™×‘×•×¦×™× (Calendar / Week View)

* ×ª×¦×•×’×” ×©×‘×•×¢×™×ª
* ×’×¨×™×¨×”/×”×—×œ×¤×” ×‘×™×Ÿ ×—×™×™×œ×™× (××•×¤×¦×™×•× ×œ×™)
* ×›× ×™×¡×” ×œ××™×¨×•×¢ â†’ â€œ×¡××Ÿ ×‘×•×¦×¢ / ×”×—×œ×£ / ×‘×˜×œâ€
* ×›×¤×ª×•×¨ â€œ×©×œ×— ×ª×–×›×•×¨×ª ×¢×›×©×™×•â€

### 4.5 ×“×•×— ×”×•×’× ×•×ª

* ×˜×‘×œ×”: ×—×™×™×œ | × ×§×•×“×•×ª 30/60/90 ×™×•× | ××¡×³ ×ª×•×¨× ×•×™×•×ª | ×¤×™×¨×•×˜ ×œ×¤×™ ×¡×•×’
* export (PDF/Excel) ××•×¤×¦×™×•× ×œ×™

---

## 5) ×ª×–×›×•×¨×•×ª ×‘-WhatsApp (True Story)

### ×¡×•×’×™ ×ª×–×›×•×¨×•×ª

1. **×¡×™×›×•× ×©×‘×•×¢×™** (×œ×›×œ ×—×™×™×œ: ××” ×™×© ×œ×• ×”×©×‘×•×¢)
2. **×™×•× ×œ×¤× ×™ ×ª×•×¨× ×•×ª** (×ª×–×›×•×¨×ª ××™×©×™×ª)

### ××™×š ×©×•×œ×—×™× ×‘×¤×•×¢×œ

×”×§×¨×™××” ×”×™× GET ×œÖ¾`/send-text` ×¢×:

* `token`
* `instance_id`
* `jid` ×‘×¤×•×¨××˜: `9725XXXXXXXX@s.whatsapp.net`
* `msg` (××•××œ×¥ ×œ×§×•×“×“ URL)

×“×•×’××”:
`https://true-story.net/api/v1/send-text?token=TOKEN&instance_id=INSTANCE_ID&jid=972501234567@s.whatsapp.net&msg=...`

### ××™×¤×” ××§×‘×œ×™× token ×•-instance_id

×›××• ×©×›×ª×‘×ª:
Dashboard â†’ ×œ×—×‘×¨ WhatsApp â†’ ××•×¦×’ **Instance ID** (×©×”×•× ×’× Token ×œ×©×™××•×© ×‘-API) + Client ID.

### × ×™×”×•×œ ×‘×ª×•×š ×”××¢×¨×›×ª ×©×œ× ×•

××¡×š â€œ×”×’×“×¨×•×ª ×•×•××˜×¡××¤â€:

* token
* instance_id
* ×”×•×“×¢×ª ×‘×“×™×§×” (â€œ×©×œ×— ×œ×¢×¦××™â€)

**×—×©×•×‘ ××‘×˜×—×”:** ×œ× ×œ×©××•×¨/×œ×”×¦×™×’ token ×‘×¦×“ ×œ×§×•×—. ×¨×§ ×‘×©×¨×ª, ××•×¦×¤×Ÿ/×‘×¡×•×“×•×ª (ENV).

### ×œ×•×’×™× ×•×©×’×™××•×ª

×œ×©××•×¨ ×œ×›×œ ×©×œ×™×—×”:

* ×œ××™ × ×©×œ×—
* ×¡×•×’ ×ª×–×›×•×¨×ª
* ×–××Ÿ ×©×œ×™×—×”
* success/failed + ×”×•×“×¢×ª API

---

## 6) ××¡×“ × ×ª×•× ×™× (ERD ×˜×‘×œ××™)

### tables

**departments**

* id, name, created_at

**soldiers**

* id
* full_name
* phone_e164 (×œ××©×œ 97250â€¦)
* department_id
* status (active / training / exempt / vacation)
* notes
* created_at

**soldier_constraints** (××•×¤×¦×™×•× ×œ×™)

* id, soldier_id
* day_of_week (0-6) / date_from/date_to
* constraint_type (no_assign / prefer_avoid / only)
* details (json)

**duty_types**

* id
* name
* category
* weight_points (int/decimal)
* default_required_people (int)
* default_frequency (daily/weekly/monthly)
* is_active

**duty_events**

* id
* duty_type_id
* start_at
* end_at (optional)
* status (planned/done/swapped/canceled/missed)
* created_by
* notes

**duty_assignments**

* id
* duty_event_id
* soldier_id
* role_label (optional)
* is_confirmed (optional)
* done_at (optional)

**points_ledger** (××•××œ×¥ ×›×“×™ ×©×”×›×œ ×™×”×™×” ×©×§×•×£ ×•×œ× â€œ××¡×¤×¨ ×§×¡×â€)

* id
* soldier_id
* duty_event_id (nullable ×× ×–×” ×ª×™×§×•×Ÿ ×™×“× ×™)
* points_delta (+/-)
* reason
* created_at

**whatsapp_settings**

* id (×‘×“×´×› 1)
* token_encrypted
* instance_id
* is_enabled

**whatsapp_logs**

* id
* soldier_id
* duty_event_id (nullable ×œ×¡×™×›×•× ×©×‘×•×¢×™)
* type (weekly_summary/day_before/manual)
* request_url_sanitized (×‘×œ×™ token)
* response_json
* success
* created_at

---

## 7) API ×¤× ×™××™ (×œ××¢×¨×›×ª ×©×œ×š) â€“ Endpoints ××•×¦×¢×™×

* `POST /auth/login` (×× ×™×©)
* `GET /soldiers?department_id=&status=`
* `POST /soldiers`
* `PUT /soldiers/:id`
* `GET /duty-types`
* `POST /duty-types`
* `PUT /duty-types/:id`
* `GET /schedule?from=&to=`
* `POST /duty-events`
* `POST /duty-events/:id/assign` (×—×™×™×œ/×™×)
* `POST /duty-events/:id/mark-done`
* `POST /duty-events/:id/swap` (××—×œ×™×£)
* `POST /auto-schedule` (×˜×•×•×— ×ª××¨×™×›×™× + ×¡×•×’×™×)
* `POST /whatsapp/test`
* `POST /whatsapp/send-reminders` (×™×“× ×™)
* `GET /fairness-report?range=60d`

---

## 8) ×× ×’× ×•×Ÿ ×ª×–××•×Ÿ (Cron Jobs)

* ×›×œ ×™×•× ×‘×©×¢×” ×§×‘×•×¢×” (×œ××©×œ 18:00):
  **×©×œ×™×—×ª â€œ×™×•× ×œ×¤× ×™â€** ×œ×›×œ ××™ ×©×™×© ×œ×• ×ª×•×¨× ×•×ª ××—×¨.
* ×¤×¢× ×‘×©×‘×•×¢ (×œ××©×œ ×—××™×©×™ 19:00):
  **×¡×™×›×•× ×©×‘×•×¢×™** ×œ×©×‘×•×¢ ×”×‘×/× ×•×›×—×™.

---

## 9) ×”×•×“×¢×•×ª ××•××œ×¦×•×ª (×˜×§×¡×˜×™×)

### ×™×•× ×œ×¤× ×™

â€œ×ª×–×›×•×¨×ª âœ… ××—×¨ ×™×© ×œ×š ×ª×•×¨× ×•×ª: {×©×_×ª×•×¨× ×•×ª}
ğŸ•’ {×©×¢×”} | ğŸ“ {××™×§×•× ×× ×™×©}
×× ×™×© ×‘×¢×™×” â€“ ×“×‘×¨ ×¢× ×”×¨×¡×´×¤.â€

### ×¡×™×›×•× ×©×‘×•×¢×™

â€œ×¡×™×›×•× ×ª×•×¨× ×•×™×•×ª ×œ×©×‘×•×¢ ×”×§×¨×•×‘ ğŸ“…

1. {×™×•×} {×©×¢×”} â€“ {×ª×•×¨× ×•×ª}
2. â€¦
   ×‘×”×¦×œ×—×” ğŸ’ªâ€

---